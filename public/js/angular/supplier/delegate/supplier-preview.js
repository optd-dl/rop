"use strict";var supplierApp=angular.module("SupplierApp",["ngRoute","ui.router","ngAnimate","ngCookies","ngMaterial","ngMessages"]);supplierApp.config(function($mdThemingProvider){var customBlueMap=$mdThemingProvider.extendPalette("indigo",{contrastDefaultColor:"light",contrastDarkColors:void 0,contrastLightColors:["50"],50:"ffffff"});$mdThemingProvider.definePalette("customBlue",customBlueMap),$mdThemingProvider.theme("default").primaryPalette("customBlue",{"default":"500","hue-1":"50","hue-3":"A400"}).accentPalette("pink"),$mdThemingProvider.theme("dracular","default").primaryPalette("grey",{"default":"500","hue-2":"800","hue-3":"900"}).accentPalette("deep-orange")}),supplierApp.config(function($mdIconProvider){$mdIconProvider.iconSet("action","/vendor/material-design-icons/sprites/svg-sprite/svg-sprite-action.svg",24).iconSet("alert","/vendor/material-design-icons/sprites/svg-sprite/svg-sprite-alert.svg",24).iconSet("av","/vendor/material-design-icons/sprites/svg-sprite/svg-sprite-av.svg",24).iconSet("communication","/vendor/material-design-icons/sprites/svg-sprite/svg-sprite-communication.svg",24).iconSet("content","/vendor/material-design-icons/sprites/svg-sprite/svg-sprite-content.svg",24).iconSet("device","/vendor/material-design-icons/sprites/svg-sprite/svg-sprite-device.svg",24).iconSet("editor","/vendor/material-design-icons/sprites/svg-sprite/svg-sprite-editor.svg",24).iconSet("file","/vendor/material-design-icons/sprites/svg-sprite/svg-sprite-file.svg",24).iconSet("hardware","/vendor/material-design-icons/sprites/svg-sprite/svg-sprite-hardware.svg",24).iconSet("image","/vendor/material-design-icons/sprites/svg-sprite/svg-sprite-image.svg",24).iconSet("maps","/vendor/material-design-icons/sprites/svg-sprite/svg-sprite-maps.svg",24).iconSet("navigation","/vendor/material-design-icons/sprites/svg-sprite/svg-sprite-navigation.svg",24).iconSet("notification","/vendor/material-design-icons/sprites/svg-sprite/svg-sprite-notification.svg",24).iconSet("social","/vendor/material-design-icons/sprites/svg-sprite/svg-sprite-social.svg",24).iconSet("toggle","/vendor/material-design-icons/sprites/svg-sprite/svg-sprite-toggle.svg",24).defaultIconSet("/vendor/material-design-icons/sprites/svg-sprite/svg-sprite-action.svg",24)}),supplierApp.controller("SupplierCtrl",["$scope","$route","$http","$location","$rootScope","$window","$state","$cookies","$mdDialog","$filter","$q",function($scope,$route,$http,$location,$rootScope,$window,$state,$cookies,$mdDialog,$filter,$q){$scope.go=function(tab){$rootScope.scrollToTop(function(){$state.go(tab)})},$rootScope.locate=function(url){$window.location.href=url},$rootScope.toPlatform=function(path){$scope.locate(Constant.protocol+"://"+Constant.host+(path?path:""))},$rootScope.scrollToTop=function(cb){"Firefox"==getBrowserType()?$("html").animate({scrollTop:0},cb):$("body").animate({scrollTop:0},cb)},$rootScope.alert=function(msg){$mdDialog.show($mdDialog.alert().clickOutsideToClose(!0).title("出错了").textContent(msg).ariaLabel(msg).ok("了解"))},$rootScope.removeLoading=function(){angular.element(".loading").hasClass("out")||$(".loading").fadeOut(0,function(){$(".loading").addClass("out")})},$('a[href^="#"]',"#partials").click(function(e){e.preventDefault()});var _lang=$cookies.get("_lang"),beforeClipboardCopy="zh-cn"==_lang?"复制到剪切板":"Copy to Clipboard",afterClipboardCopy="zh-cn"==_lang?"已复制":"Copied",workaroundSupportClipboard=function(action){var actionMsg=" 来"+("cut"===action?"剪切":"拷贝"),actionKey="cut"===action?"X":"C";return actionMsg=/iPhone|iPad/i.test(navigator.userAgent)?"暂不支持iPhone和iPad :(":/Mac/i.test(navigator.userAgent)?"请按 ⌘-"+actionKey+actionMsg:"请按 Ctrl-"+actionKey+actionMsg};$scope.breadcrumbs=[],$scope.selectedEntry=0,$scope.defaultDetails={api_name:"API名字"},$scope.apiDetails=$scope.defaultDetails,$scope.domainDetails=$scope.defaultDetails,$scope.clipboardHints=beforeClipboardCopy,$scope.makeDebugUrl=function(api){return Constant.protocol+"://"+Constant.host+"/ApiTool/index?sign="+api},$scope.makeSDKUrl=function(api){return Constant.protocol+"://"+Constant.host+"/welcome/sdkTool"};var catQ=function(){return $http.post("/agent",{module:"supplier",partial:"API",api:"get_ssv_cat",param:{ssv_user_id:$rootScope.ssv_user_id}}).then(function(body){body.data&&body.data.cat_list&&body.data.cat_list.length?$scope.cat_list=body.data.cat_list:$rootScope.alert(body.data.msg)},function(why){$rootScope.alert(why)})},apiQ=function(){return $http.post("/agent",{module:"supplier",partial:"API",api:"api_list",param:{ssv_user_id:$rootScope.ssv_user_id,cat_id:$scope.apiCategoryId}}).then(function(body){body.data&&body.data.data_list&&body.data.data_list.length?$scope.api_list=body.data.data_list:$rootScope.alert(body.data.msg)},function(why){$rootScope.alert(why)})},domainQ=function(){return $http.post("/agent",{module:"supplier",partial:"API",api:"api_domain",param:{ssv_user_id:$rootScope.ssv_user_id,cat_id:$scope.apiCategoryId}}).then(function(body){body.data&&body.data.data_list&&body.data.data_list.length?$scope.api_domain=body.data.data_list:$rootScope.alert(body.data.msg)},function(why){$rootScope.alert(why)})},domainDetailQ=function(domain_id,cat_id){return cat_id&&($scope.apiCategoryId=cat_id),$scope.apiDetails=$scope.defaultDetails,$http.post("/agent",{module:"supplier",partial:"API",api:"domain_detail_preview",param:{domain_id:domain_id}}).then(function(body){return body.data&&body.data.data_list&&body.data.data_list.length?$scope.domainDetails=body.data.data_list[0]:$scope.domainDetails=$scope.defaultDetails,cat_id&&($scope.breadcrumbs=[$scope.domainDetails]),$scope.domainDetails.domain_desc&&($scope.domainDetails.domain_desc_expanded=!0),$scope.domainDetails.property&&($scope.domainDetails.property_expanded=!0),$scope.loading=!1,body},function(why){$rootScope.alert(why),$scope.loading=!1})};$scope.domainDetailQ=function(domain_id,cat_id){$scope.loading||($scope.loading=!0,cat_id&&($scope.apiCategoryId=cat_id),$rootScope.scrollToTop(function(){domainDetailQ(domain_id,cat_id)}))};var apiDetailQ=function(api_id,cat_id){return cat_id&&($scope.apiCategoryId=cat_id),$scope.domainDetails=$scope.defaultDetails,$rootScope.scrollToTop(),$http.post("/agent",{module:"supplier",partial:"API",api:"api_detail_preview",param:{api_id:api_id}}).then(function(body){body.data&&body.data.data_list&&body.data.data_list.length?$scope.apiDetails=body.data.data_list[0]:$scope.apiDetails=$scope.defaultDetails,$scope.breadcrumbs=[$scope.apiDetails],$scope.apiDetails.api_id=api_id,$scope.apiDetails.api_desc&&($scope.apiDetails.api_desc_expanded=!0),$scope.apiDetails.sysparam_expanded=!1,$scope.apiDetails.request_parameter_type&&($scope.apiDetails.request_parameter_type_expanded=!0),$scope.apiDetails.request_parameter_example&&($scope.apiDetails.request_parameter_example_expanded=!0),$scope.apiDetails.response_parameter_desc&&($scope.apiDetails.response_parameter_desc_expanded=!0),$scope.apiDetails.response_parameter_example&&($scope.apiDetails.response_parameter_example_expanded=!0),$scope.apiDetails.busparam&&$scope.apiDetails.busparam.length&&($scope.apiDetails.busparam_expanded=!0),$scope.apiDetails.result&&$scope.apiDetails.result.length&&($scope.apiDetails.result_expanded=!0),$scope.apiDetails.return_example_xml&&($scope.apiDetails.return_example_xml_expanded=!0),$scope.apiDetails.error_example_xml_expanded=!1,$scope.apiDetails.buserror&&($scope.apiDetails.buserror_expanded=!0),$scope.apiDetails.syserror_expanded=!1,$scope.apiDetails.debug_expanded=!0,setTimeout(function(){var return_example_xml=$filter("unescapeHtml")($scope.apiDetails.return_example_xml,"xml"),error_example_xml=$filter("unescapeHtml")($scope.apiDetails.error_example_xml,"xml"),return_example_json=$filter("unescapeHtml")($scope.apiDetails.return_example_json,"xml"),error_example_json=$filter("unescapeHtml")($scope.apiDetails.error_example_json,"xml");packageTree(return_example_xml?return_example_xml:""),packageTreeError(error_example_xml?error_example_xml:""),Process(return_example_json?return_example_json:"{}"),ProcessError(error_example_json?error_example_json:"{}")},400),$scope.loading=!1},function(why){$rootScope.alert(why),$scope.loading=!1})};$scope.apiDetailQ=function(api_id,cat_id){$scope.loading||(cat_id&&($scope.apiCategoryId=cat_id),$scope.loading=!0,$rootScope.scrollToTop(function(){apiDetailQ(api_id,cat_id)}))},$scope.resetView=function(){$scope.selectedEntry?(setTimeout(function(){$(".md-expand.active md-tab-item").eq(0).click()}),setTimeout(function(){$scope.param=void 0,$scope.breadcrumbs=[],!$scope.cat_list&&catQ(),$scope.apiCategoryId=void 0},200)):($scope.param=void 0,$scope.breadcrumbs=[],!$scope.cat_list&&catQ(),$scope.apiCategoryId=void 0)},$scope.init=function(info,param){var _param=void 0,_info=void 0;try{_param=JSON.parse(param)}catch(e){_param=void 0}try{_info=JSON.parse(info)}catch(e){_info=void 0}_info||_param?($rootScope.ssv_user_id=_info.ssv_id,$scope.apiCategoryId=_info.cat_id,$scope.param=_param):$rootScope.toPlatform(),$scope.param.apiPreview?(setTimeout(function(){$(".md-expand.active md-tab-item").eq(1).click()}),$scope.apiDetailQ($scope.param.apiPreview,$scope.apiCategoryId)):$scope.param.domainPreview?(setTimeout(function(){$(".md-expand.active md-tab-item").eq(1).click()}),$scope.domainDetailQ($scope.param.domainPreview,$scope.apiCategoryId)):$rootScope.toPlatform()},$scope.selectCategory=function(cat_id){$scope.selectedCatId=cat_id,apiQ(),domainQ()},$scope.selectEntry=function(entry){$scope.selectedEntry=entry},$scope.toSubDomain=function(id,details){if(!id)return void console.log("toSubDomain: id = "+id+";detail="+JSON.stringify(details));if(details){var lastBreadcrumb=$scope.breadcrumbs[$scope.breadcrumbs.length-1];$rootScope.scrollToTop(function(){lastBreadcrumb&&(lastBreadcrumb.api_id?lastBreadcrumb.api_id!=id:lastBreadcrumb.domain_id!=id)&&domainDetailQ(id).then(function(){$scope.breadcrumbs.push($scope.domainDetails)},function(why){$rootScope.alert(why)}).then(function(){setTimeout(function(){$(".md-expand.active md-tab-item").eq(1).click()},400)})})}else{var id_list=$scope.breadcrumbs.map(function(r,i){return r.api_id?r.api_id:r.domain_id}),subdomain_index=id_list.indexOf(id);$scope.breadcrumbs.splice(subdomain_index+1);var lastBreadcrumb=$scope.breadcrumbs[$scope.breadcrumbs.length-1];lastBreadcrumb.api_id?$rootScope.scrollToTop(function(){apiDetailQ(id).then(function(){setTimeout(function(){$(".md-expand.active md-tab-item").eq(0).click()},400)})}):$rootScope.scrollToTop(function(){domainDetailQ(id).then(function(){setTimeout(function(){$(".md-expand.active md-tab-item").eq(1).click()},400)})})}},$scope.copyToClipboard=function(details){var id=details.api_id?details.api_id:details.domain_id,method=details.api_id?"ApiPreview":"ApiDomainPreview";return Constant.protocol+"://"+Constant.host+"/api/"+method+"-"+id+".html"},setTimeout(function(){var cliper=new Clipboard(".cliper");setTimeout(function(){$(".cliper").tooltip({placement:"right"})}),cliper.on("success",function(e){e.clearSelection(),$(e.trigger).attr("data-original-title",afterClipboardCopy).tooltip("show"),setTimeout(function(){$(e.trigger).attr("data-original-title",beforeClipboardCopy),$(document).find($(e.trigger).data()["bs.tooltip"].$tip).length&&$(e.trigger).tooltip("show")},3e3)}),cliper.on("error",function(e){$(e.trigger).attr("data-original-title",workaroundSupportClipboard(e.action)).tooltip("show"),setTimeout(function(){$(e.trigger).attr("data-original-title",beforeClipboardCopy),$(document).find($(e.trigger).data()["bs.tooltip"].$tip).length&&$(e.trigger).tooltip("show")},5e3)})},1500),$rootScope.removeLoading()}]),supplierApp.filter("escapeHtml",function(){var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};return function(str){return String(str).replace(/[&<>"'\/]/g,function(s){return entityMap[s]})}}),supplierApp.filter("unescapeHtml",function(){var entityMap={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#x2F;":"/"};return function(str,type){if(str){var rawStr=String(str).replace(/(&amp;|&lt;|&gt;|&quot;|&#39;|&#x2F;)/g,function(s){return entityMap[s]});if(str&&"undefined"!=str){if("json"==type)return JSON.stringify(JSON.parse(rawStr),null,2);if("xml"==type)return formatXml(rawStr)}return rawStr}}}),supplierApp.filter("parseYear",function(){return function(str,type){var year=str;try{year=new Date(str).getFullYear()}catch(e){console.log("warning, unable to parse the date string")}return year}}),supplierApp.filter("parseMonth",function(){return function(str,type){var month=str;try{month=new Date(str).getMonth()+1}catch(e){console.log("warning, unable to parse the date string")}return month}}),supplierApp.filter("parseDate",function(){return function(str,type){var date=str;try{date=new Date(str).getDate(),date<10&&(date="0"+date)}catch(e){console.log("warning, unable to parse the date string")}return date}}),supplierApp.filter("trusthtml",["$sce",function($sce){return function(t){return $sce.trustAsHtml(t)}}]);