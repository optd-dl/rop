"use strict";define([],function(){return["$rootScope","$scope","$http","$mdDialog","$q",function($rootScope,$scope,$http,$mdDialog,$q){$rootScope.tab="productlist",$scope.mode=0,$scope.enterMode=function(mode,cb){$scope.mode=mode,cb&&cb.call()},$scope.exitMode=function(cb){$scope.mode=0,cb&&cb.call()};var ExportController=function(scope,$mdDialog){scope.test_url="0",scope.online_url="0";var exportFile=function(){return scope.exporting=!0,$rootScope.ajax("api_export",{keyword:$scope.keyword,cat_id:$scope.panelSelection.panelCat.cat_id,group_id:$scope.panelSelection.panelCatGroup.group_id,status:$scope.panelSelection.panelStatus.status_id,sort_name:$scope.panelSelection.sorter.name,sort_flag:$scope.panelSelection.sorter.sort,test_url:scope.test_url,online_url:scope.online_url},function(data){if("Chrome"==$rootScope.browserType){var a=window.document.createElement("a");a.href=data.export_url,a.download=!0,a.click()}else window.open(data.export_url,"_blank");return scope.exporting=!1,data})};scope.triggerExport=function(){scope.exporting||exportFile().then(function(data){data&&$mdDialog.hide()})},scope.closeExport=function(){$mdDialog.hide()}};$scope.showExport=function(ev){$mdDialog.show({controller:ExportController,template:'<md-dialog aria-label="Mango (Fruit)" style="width: 256px">\n                                <md-dialog-content class="md-dialog-content">\n                                    <div class="md-dialog-content-body">\n                                        <md-checkbox ng-model="test_url" aria-label="Checkbox 1" class="md-primary" ng-true-value="\'1\'" ng-false-value="\'0\'" >测试URL</md-checkbox>\n                                        <md-checkbox ng-model="online_url" aria-label="Checkbox 2" class="md-primary" ng-true-value="\'1\'" ng-false-value="\'0\'" >正式URL</md-checkbox>\n                                    </div>\n                                </md-dialog-content>\n                                <md-dialog-actions layout="row">\n                                  <md-button ng-click="closeExport()">\n                                    取消\n                                  </md-button>\n                                  <md-button ng-click="triggerExport()">\n                                   导出\n                                  </md-button>\n                                </md-dialog-actions>\n                            </md-dialog>',parent:angular.element(document.querySelector("body>section>md-content")),targetEvent:ev,clickOutsideToClose:!0})},$scope.panelSelection={};var initName={id:"",name:"全部"},initCat={cat_id:"",cat_name:"全部分类"};$scope.reset=function(){$scope.panelSelection.panelName=initName,$scope.panelSelection.panelCat=initCat,$scope.panelSelection.sorter={name:"",sort:"1"},$scope.columns=[{text:"产品名称",name:"product_name"},{text:"产品分类",name:"cat_id",style:{width:"128px","text-align":"center"}},{text:"添加时间",name:"create_time",sort:"1",style:{width:"160px","text-align":"center"}},{text:"显示产品价格",name:"remark",style:{width:"160px"}}],$scope.keyword="",$scope.batch=!1,$scope.pageIndex=1,$scope.pageSize=new Number(10)},$scope.reset(),$scope.chooseName=function(nameObj){$scope.panelSelection.panelName=nameObj?nameObj:initName,$scope.pageIndex=1,$scope.pageSize=new Number(10)},$scope.chooseCat=function(catObj){$scope.panelSelection.panelCat=catObj?catObj:initCat,$scope.pageIndex=1,$scope.pageSize=new Number(10)},$scope.searcher=function(index,size){return $scope.refreshing=!0,$rootScope.ajax("list",{pageindex:index?index:$scope.pageIndex,pagesize:size?size:$scope.pageSize,product_name:$scope.keyword,sort_name:"create_time"==$scope.panelSelection.sorter.name?"rx_insertTime":$scope.panelSelection.sorter.name,sort_flag:$scope.panelSelection.sorter.sort},function(data){"boolean"==typeof data.is_success&&data.is_success||"string"==typeof data.is_success&&"true"==data.is_success?($scope.tableData=data.data_list,$scope.total=data.list_count):($rootScope.alert(data.msg),$scope.total=0)},function(){$scope.total=0})["finally"](function(){$scope.refreshing=!1})},$scope.tableData=[],$scope.research=function(){$scope.pageIndex=1,$scope.pageSize=new Number(10)};var mainQ=$rootScope.ajax("init",function(data){console.log(data),$scope.originalPanel=JSON.parse(JSON.stringify(data)),$scope.panel=data});$scope.canVisistProduct=function(){return $scope.tableData&&$scope.tableData._select},$scope.canInsertProduct=function(){return $scope.panel&&"1"==$scope.panel.role_list.btnInsert},$scope.canDeleteProduct=function(array){return!(!(array&&array.length&&array[0])||$scope.panel&&"0"==$scope.panel.role_list.btnDelete)},$scope.canUpdateProduct=function(array){return!(!(array&&array.length&&array[0])||$scope.panel&&"0"==$scope.panel.role_list.btnUpdate)},$scope.deleteProduct=function(row){return $rootScope.confirm("请确认是否要删除产品？",function(){return $rootScope.ajax("delete",{product_id:row.product_id},function(data){$scope.research(),$rootScope.warn("删除成功",1)})})};var initialUpdaterProduct={product_name:"",remark:""},initialSteps=[{name:"基本信息"},{name:"API列表"},{name:"产品定价"}];$scope.updaterProduct=JSON.parse(JSON.stringify(initialUpdaterProduct)),$scope.step=0,$scope.steps=initialSteps,$scope.updaterSelection={panelCat:initCat},$scope.updateProductMode=function(mode){mainQ.then(function(data){return $rootScope.ajax("detail",{product_id:""},function(data){$scope.mode=mode,$scope.updaterSelection.panelCat=initCat,0!=$scope.step&&($scope.step=0),$scope.steps=initialSteps,$scope.updaterProduct=data,console.log(data)})},function(e){$rootScope.alert(e)})},$scope.nextStep=function(){return $scope.updaterProduct._forView?void($scope.step<2&&$scope.step++):$scope.updaterProductForm.$invalid?void($scope.updaterProductForm.$error.required&&$scope.updaterProductForm.$error.required.forEach(function(r){r.$setDirty(!0)})):void($scope.step<1&&$scope.step++)},$scope.previousStep=function(){$scope.step>0&&$scope.step--},$scope.cancelStep=function(){$scope.updaterProduct=JSON.parse(JSON.stringify(initialUpdaterProduct)),$scope.updaterProductForm.$setPristine(),$scope.mode=0,$scope.step=0,$scope.updaterSelection={panelCat:initCat}},$scope.chooseUpdaterCat=function(cat){$scope.updaterSelection.panelCat=cat?cat:initCat,$scope.updaterProduct.cat_id=$scope.updaterSelection.panelCat.cat_id},$scope.appendRow=function(row,list){list.push(row?row:{})},$scope.removeRow=function(row,list){list.splice(list.indexOf(row),1)},window.test=$scope,$scope.injectorLoaded=!0}]});